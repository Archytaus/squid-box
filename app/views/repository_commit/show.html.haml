
%h2
  #{@commit.message}

.author
  #{@commit.author}

.date
  #{I18n.l @commit.date, :format => :short}

.commit-id
  Commit #{@commit.id}

.change-stats
  .added
    + #{@commit.stats.additions}
  .deleted
    = "- #{@commit.stats.deletions}"

.diffs{:data => {:repository => @repository.id, :commit => @commit.id}}
  - @commit.diffs.each do |diff|

    .file-diff{:data => {:file => diff.b_path}}
      - comments = @comments.find_all { |comment| comment.file == diff.b_path }
      %br

      .file-name
        %h3
          - if diff.a_path != diff.b_path
            #{diff.a_path} ==> #{diff.b_path}
          - else
            = diff.a_path

      .container.line-diff{:data => {:file => diff.b_path}}
        - # only need to check the original
        - original = diff.a_blob.nil? ? nil : diff.a_blob.data

        - diffy_diff = Diffy::Diff.new(original, diff.b_blob.data, {:allow_empty_diff => true})
        = render :partial => "commit_diff", :locals => {:diff => diffy_diff, :comments => comments}